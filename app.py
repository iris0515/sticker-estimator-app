# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1W_qDnZOBpyI-R1n7nguT1IehiUP6K6Ph
"""

# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1W_qDnZOBpyI-R1n7nguT1IehiUP6K6Ph
"""

import streamlit as st
import math
import pandas as pd

# ì„¤ì •
st.set_page_config(page_title="ìŠ¤í‹°ì»¤ ê²¬ì  ê³„ì‚°ê¸°", page_icon="ğŸ“", layout="centered")

# ê³µìš© í•¨ìˆ˜
def format_number(n): return format(n, ",").replace(",", ".")
def number_to_korean(num):
    digits = ["", "ì¼", "ì´", "ì‚¼", "ì‚¬", "ì˜¤", "ìœ¡", "ì¹ ", "íŒ”", "êµ¬"]
    units = ["", "ì‹­", "ë°±", "ì²œ"]
    big_units = ["", "ë§Œ", "ì–µ", "ì¡°", "ê²½"]
    result, group = "", 0
    while num > 0:
        part, part_str = num % 10000, ""
        num //= 10000
        for i in range(4):
            d = part % 10
            part //= 10
            if d != 0:
                part_str = (units[i] if d == 1 and i > 0 else digits[d] + units[i]) + part_str
        result = part_str + big_units[group] + result if part_str else result
        group += 1
    return result
def format_result(n): return f"{format_number(n)} ({number_to_korean(n)})"

# ë””ìì¸
st.markdown("""
    <style>
    .main { background-color: #f8fcfb; }
    .stButton>button {
        background-color: #00b894;
        color: white;
        border-radius: 8px;
        padding: 0.5em 1.2em;
        font-weight: bold;
    }
    .stTabs [role="tab"] {
        font-size: 18px;
        padding: 10px;
    }
    </style>
""", unsafe_allow_html=True)

# íƒ€ì´í‹€
st.markdown("<h1 style='text-align:center; color:#00b894;'>ğŸ§¾ ìŠ¤í‹°ì»¤ ê²¬ì  ê³„ì‚°ê¸°</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align:center;'>ëª¨ë“  ê²¬ì ì„ í•˜ë‚˜ì˜ ì•±ì—ì„œ ê°„í¸í•˜ê²Œ ê³„ì‚°í•´ë³´ì„¸ìš”!</p>", unsafe_allow_html=True)

# íƒ­
tab1, tab2, tab3 = st.tabs(["ğŸ“ ë©´ì  ê³„ì‚°ê¸°", "ğŸ“¦ í—¤ë‹¤í¬ì¥", "ğŸ¨ ê¸°íƒ€ ê²¬ì "])

# â–¶ï¸ tab1: ë©´ì  ê³„ì‚°ê¸°
with tab1:
    st.markdown("### ğŸ“ ë©´ì  ê³„ì‚°ê¸° (ì—…ê·¸ë ˆì´ë“œ)")

    st.info("270x400mm ë˜ëŠ” 280x400mm ìš©ì§€ì— ìŠ¤í‹°ì»¤ê°€ ì–¼ë§ˆë‚˜ ë“¤ì–´ê°€ëŠ”ì§€ ê³„ì‚°í•´ì¤ë‹ˆë‹¤.")

    col1, col2, col3 = st.columns(3)
    with col1:
        width = st.number_input("ê°€ë¡œ(mm)", min_value=1.0, value=50.0, step=1.0)
    with col2:
        height = st.number_input("ì„¸ë¡œ(mm)", min_value=1.0, value=50.0, step=1.0)
    with col3:
        quantity = st.number_input("ì´ ìˆ˜ëŸ‰", min_value=1, value=100, step=1)

    sheet_type = st.selectbox("ê¸°ë³¸ ìš©ì§€ ì‚¬ì´ì¦ˆ", ["270x400mm", "280x400mm"])

    if st.button("ë©´ì  ê³„ì‚°"):
        max_width, max_height = (270, 400) if sheet_type == "270x400mm" else (280, 400)

        # í•œ í–‰ì— ëª‡ ê°œ ë“¤ì–´ê°€ëŠ”ì§€
        num_width = math.floor(max_width / width)
        num_height = math.floor(max_height / height)

        # í•œ ì¥ì— ë“¤ì–´ê°€ëŠ” ì´ ìˆ˜
        total_per_sheet = num_width * num_height

        if total_per_sheet == 0:
            st.error("âŒ í•´ë‹¹ í¬ê¸°ëŠ” ìš©ì§€ì— ë“¤ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        else:
            # ê¸°ë³¸ ê³„ì‚°
            total_needed_sheets = math.ceil(quantity / total_per_sheet)
            im_basis = math.ceil(quantity / 20) if total_per_sheet >= 20 else total_needed_sheets
            sticky_basis = math.ceil(quantity / 16) if total_per_sheet >= 16 else total_needed_sheets

            st.success(f"âœ… í•œ ì¥ë‹¹ ìµœëŒ€ ë°°ì¹˜ ìˆ˜: {format_result(total_per_sheet)}ê°œ")
            st.info(f"ğŸ“„ ê¸°ë³¸ ìˆ˜ëŸ‰ ê¸°ì¤€: {format_result(total_needed_sheets)}ì¥")
            st.write(f"ğŸ’¡ ì™„ì¹¼ ê¸°ì¤€ ìˆ˜ëŸ‰ (ì•„ì„ ê¸°ì¤€ 20ê°œ): {format_result(im_basis)}ì¥")
            st.write(f"ğŸ’¡ ì™„ì¹¼ ê¸°ì¤€ ìˆ˜ëŸ‰ (ìŠ¤í‹°í‚¤ ê¸°ì¤€ 16ê°œ): {format_result(sticky_basis)}ì¥")

# â–¶ï¸ tab2: í—¤ë‹¤í¬ì¥ ê³„ì‚°ê¸°
with tab2:
    st.markdown("### ğŸ“¦ í—¤ë‹¤í¬ì¥ ê²¬ì  ê³„ì‚°ê¸° (ì—…ê·¸ë ˆì´ë“œ)")

    st.subheader("1ï¸âƒ£ í—¤ë‹¤ ë©´ì  ê³„ì‚°ê¸°")
    col1, col2 = st.columns(2)
    width = col1.number_input("ê°€ë¡œê¸¸ì´ (mm)", min_value=1.0, value=50.0)
    height = col2.number_input("ì„¸ë¡œê¸¸ì´ (mm)", min_value=1.0, value=50.0)

    if st.button("ë©´ì  ê³„ì‚°"):
        container_width, container_height = 255, 385
        num_width = math.floor(container_width / width)
        num_height = math.floor(container_height / height)
        total = num_width * num_height
        if total == 0:
            st.error("âŒ ì…ë ¥í•œ í¬ê¸°ì˜ ì•„ì´í…œì´ ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        else:
            st.success(f"âœ… í•œ ì¥ì— ìµœëŒ€ {total}ê°œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

    st.divider()

    st.subheader("2ï¸âƒ£ í—¤ë‹¤ ê²¬ì  ê³„ì‚°ê¸°")

    col3, col4 = st.columns(2)
    quantity = col3.number_input("í—¤ë‹¤ ìˆ˜ëŸ‰", min_value=10, value=100, step=10)
    batch_under_9 = col4.checkbox("9ê°œ ì´í•˜ ë°°ì¹˜ (ì¥ë‹¹ +50ì›)")
    sticker_included = col4.checkbox("ìŠ¤í‹°ì»¤ ì£¼ë¬¸ í¬í•¨ (ì¥ë‹¹ -50ì›)")

    # ë‹¨ê°€ ê³„ì‚°
    if quantity >= 500:
        heda_unit = 250
    elif quantity >= 300:
        heda_unit = 300
    elif quantity >= 200:
        heda_unit = 350
    elif quantity >= 100:
        heda_unit = 400
    else:
        heda_unit = 450

    if batch_under_9:
        heda_unit += 50
    if sticker_included:
        heda_unit -= 50

    heda_total = quantity * heda_unit

    st.info(f"í—¤ë‹¤ ë‹¨ê°€: {format_result(heda_unit)}ì›")
    st.success(f"í—¤ë‹¤ ê²¬ì  í•©ê³„: {format_result(heda_total)}ì›")

    st.divider()

    st.subheader("3ï¸âƒ£ í¬ì¥ ê²¬ì  ê³„ì‚°ê¸°")

    col5, col6 = st.columns(2)
    qty = col5.number_input("í¬ì¥ ìˆ˜ëŸ‰", min_value=10, value=100, step=10)
    header_add = col6.checkbox("í—¤ë” ì¥ì°© (ì¥ë‹¹ +200ì›)")
    over_8_types = col6.checkbox("8ì¢… ì´ìƒ (ì¥ë‹¹ +100ì›)")
    over_12_types = col6.checkbox("12ì¢… ì´ìƒ (ì¥ë‹¹ +200ì›)")
    opp_cost = col6.checkbox("OPP í¬ì¥ë¹„ìš© (ì¥ë‹¹ +50ì›)")

    # í¬ì¥ ë‹¨ê°€ ê³„ì‚°
    if qty >= 400:
        packaging_unit = 200
    elif qty >= 300:
        packaging_unit = 250
    elif qty >= 200:
        packaging_unit = 300
    elif qty >= 100:
        packaging_unit = 400
    else:
        packaging_unit = 500

    if header_add:
        packaging_unit += 200
    if over_8_types:
        packaging_unit += 100
    if over_12_types:
        packaging_unit += 200
    if opp_cost:
        packaging_unit += 50

    packaging_total = qty * packaging_unit

    st.info(f"í¬ì¥ ë‹¨ê°€: {format_result(packaging_unit)}ì›")
    st.success(f"í¬ì¥ ê²¬ì  í•©ê³„: {format_result(packaging_total)}ì›")

    st.divider()

    st.subheader("ğŸ’° ì´ í•©ê³„")

    total_sum = heda_total + packaging_total
    total_unit_price = heda_unit + packaging_unit

    st.success(f"ì´ ê²¬ì : {format_result(total_sum)}ì›")
    st.info(f"ì¥ë‹¹ ì´í•© ë‹¨ê°€: {format_result(total_unit_price)}ì›")

# ---------------- TAB 3: ê¸°íƒ€ ê²¬ì  ê³„ì‚°ê¸° ----------------
with tab3:
    st.markdown("### ğŸ“‹ ì¼ë°˜ / ì™„ì¹¼ / ì‘ê°€ ê²¬ì  ê³„ì‚°ê¸°")

    # ì¼ë°˜ ê²¬ì 
    with st.expander("ğŸ“‹ ì¼ë°˜ ê²¬ì  ê³„ì‚°ê¸° (ì—…ê·¸ë ˆì´ë“œ)"):
        st.markdown("#### ğŸ“¦ ìš©ì§€ + ì½”íŒ… + ì¬ë‹¨ ì˜µì…˜ì— ë”°ë¥¸ ê²¬ì  ê³„ì‚°")
        general_data = pd.DataFrame({
            "ìŠ¤í‹°ì»¤ìš©ì§€": ["ìœ í¬ì§€"] * 3 + ["ë¦¬ë¬´ë²„ë¸”ìœ í¬ì§€"] * 3 + ["ì•„íŠ¸ì§€"] * 3,
            "ì½”íŒ…í•„ë¦„": ["ë¬´ê´‘", "ìœ ê´‘", "ì—†ìŒ"] * 3,
            "ì¬ë‹¨ì—†ì„ë•Œê°€ê²©": [5000, 5000, 5000, 5500, 5500, 5500, 4500, 4500, 4500],
            "ì¬ë‹¨ìˆì„ë•Œê°€ê²©": [7000, 7000, 7000, 7500, 7500, 7500, 6500, 6500, 6500]
        })
        col1_gen, col2_gen, col3_gen = st.columns(3)
        with col1_gen:
            g_type = st.selectbox("ìŠ¤í‹°ì»¤ ìš©ì§€", general_data["ìŠ¤í‹°ì»¤ìš©ì§€"].unique())
        with col2_gen:
            g_coating = st.selectbox("ì½”íŒ… í•„ë¦„", ["ë¬´ê´‘", "ìœ ê´‘", "ì—†ìŒ"])
        with col3_gen:
            g_cut = st.selectbox("ì¬ë‹¨ ì—¬ë¶€", ["ìˆìŒ", "ì—†ìŒ"])
        g_qty = st.number_input("ì œì‘ ìˆ˜ëŸ‰", min_value=1, value=100)
        if st.button("ì¼ë°˜ ê²¬ì  ê³„ì‚°", key="general_calc"):
            row = general_data[(general_data["ìŠ¤í‹°ì»¤ìš©ì§€"] == g_type) & (general_data["ì½”íŒ…í•„ë¦„"] == g_coating)]
            if not row.empty:
                base_price = row["ì¬ë‹¨ìˆì„ë•Œê°€ê²©"].values[0] if g_cut == "ìˆìŒ" else row["ì¬ë‹¨ì—†ì„ë•Œê°€ê²©"].values[0]
                coating_extra = 500 if g_coating in ["ë¬´ê´‘", "ìœ ê´‘"] else 0
                unit_price = base_price + coating_extra
                total_price = unit_price * g_qty
                st.success(f"âœ”ï¸ ë‹¨ê°€: {format_result(unit_price)}ì›")
                st.info(f"ğŸ’° ì´ ê°€ê²©: {format_result(total_price)}ì›")

    # ì™„ì¹¼ ìŠ¤í‹°í‚¤
    with st.expander("ğŸ§· ì™„ì¹¼ ê²¬ì  ê³„ì‚°ê¸° (ìŠ¤í‹°í‚¤, ì—…ê·¸ë ˆì´ë“œ)"):
        sticky_data = pd.DataFrame([
            {"ìš©ì§€": "í”„ë¦¬ë¯¸ì—„ì™„ì¹¼", "ì½”íŒ…": "ìœ ê´‘", "ìš©ì§€ê°€ê²©": 5000, "ì½”íŒ…ê°€ê²©": 500},
            {"ìš©ì§€": "í”„ë¦¬ë¯¸ì—„ì™„ì¹¼", "ì½”íŒ…": "ìŠ¤íŒŒí´", "ìš©ì§€ê°€ê²©": 5000, "ì½”íŒ…ê°€ê²©": 1000},
            {"ìš©ì§€": "ìœ í¬ì§€", "ì½”íŒ…": "ë§¤íŠ¸í„", "ìš©ì§€ê°€ê²©": 4000, "ì½”íŒ…ê°€ê²©": 1300},
            {"ìš©ì§€": "ì•„íŠ¸ì§€", "ì½”íŒ…": "ë²¨ë²³ë¬´ê´‘", "ìš©ì§€ê°€ê²©": 3800, "ì½”íŒ…ê°€ê²©": 1000}
        ])
        s_type = st.selectbox("ìŠ¤í‹°ì»¤ ìš©ì§€ (ìŠ¤í‹°í‚¤)", sticky_data["ìš©ì§€"].unique())
        s_coating = st.selectbox("ì½”íŒ… í•„ë¦„ (ìŠ¤í‹°í‚¤)", sticky_data[sticky_data["ìš©ì§€"] == s_type]["ì½”íŒ…"].unique())
        s_qty = st.number_input("ì œì‘ ìˆ˜ëŸ‰ (ìŠ¤í‹°í‚¤)", min_value=1, value=100)
        if st.button("ìŠ¤í‹°í‚¤ ê²¬ì  ê³„ì‚°", key="sticky_calc"):
            row = sticky_data[(sticky_data["ìš©ì§€"] == s_type) & (sticky_data["ì½”íŒ…"] == s_coating)]
            if not row.empty:
                base_price = row.iloc[0]["ìš©ì§€ê°€ê²©"] + row.iloc[0]["ì½”íŒ…ê°€ê²©"]
                if s_qty >= 125: unit_price = base_price - 500
                elif s_qty >= 62: unit_price = base_price - 300
                elif s_qty >= 31: unit_price = base_price - 200
                else: unit_price = base_price
                total_price = unit_price * s_qty
                st.success(f"âœ”ï¸ ë‹¨ê°€: {format_result(unit_price)}ì›")
                st.info(f"ğŸ’° ì´ ê°€ê²©: {format_result(total_price)}ì›")

    # ì™„ì¹¼ ì•„ì„
    with st.expander("ğŸ§² ì™„ì¹¼ ê²¬ì  ê³„ì‚°ê¸° (ì•„ì„, ì—…ê·¸ë ˆì´ë“œ)"):
        im_data = pd.DataFrame([
            {"ìš©ì§€": "ì•„íŠ¸ì§€", "ì½”íŒ…": "ë¬´ê´‘", "ìš©ì§€ê°€ê²©": 4100, "ì½”íŒ…ê°€ê²©": 500},
            {"ìš©ì§€": "ì•„íŠ¸ì§€", "ì½”íŒ…": "ìŠ¤íŒŒí´(ëª¨ë˜ì•Œ)", "ìš©ì§€ê°€ê²©": 4100, "ì½”íŒ…ê°€ê²©": 1000},
            {"ìš©ì§€": "ë¦¬ë¬´ë²„ë¸”ì•„íŠ¸ì§€", "ì½”íŒ…": "ë²¨ë²³ë¬´ê´‘", "ìš©ì§€ê°€ê²©": 5100, "ì½”íŒ…ê°€ê²©": 1000},
            {"ìš©ì§€": "ìœ í¬ì§€", "ì½”íŒ…": "ìœ ê´‘", "ìš©ì§€ê°€ê²©": 4500, "ì½”íŒ…ê°€ê²©": 500},
            {"ìš©ì§€": "ë¦¬ë¬´ë²„ë¸”ìœ í¬ì§€", "ì½”íŒ…": "ë³„ë¹›", "ìš©ì§€ê°€ê²©": 5500, "ì½”íŒ…ê°€ê²©": 1000}
        ])
        im_type = st.selectbox("ìŠ¤í‹°ì»¤ ìš©ì§€ (ì•„ì„)", im_data["ìš©ì§€"].unique())
        im_coating = st.selectbox("ì½”íŒ… í•„ë¦„ (ì•„ì„)", im_data[im_data["ìš©ì§€"] == im_type]["ì½”íŒ…"].unique())
        im_qty = st.number_input("ì œì‘ ìˆ˜ëŸ‰ (ì•„ì„)", min_value=1, value=100)
        if st.button("ì•„ì„ ê²¬ì  ê³„ì‚°", key="im_calc"):
            row = im_data[(im_data["ìš©ì§€"] == im_type) & (im_data["ì½”íŒ…"] == im_coating)]
            if not row.empty:
                base_price = row.iloc[0]["ìš©ì§€ê°€ê²©"] + row.iloc[0]["ì½”íŒ…ê°€ê²©"]
                if im_qty >= 100: unit_price = base_price - 700
                elif im_qty >= 70: unit_price = base_price - 400
                elif im_qty >= 30: unit_price = base_price - 200
                else: unit_price = base_price
                total_price = unit_price * im_qty
                st.success(f"âœ”ï¸ ë‹¨ê°€: {format_result(unit_price)}ì›")
                st.info(f"ğŸ’° ì´ ê°€ê²©: {format_result(total_price)}ì›")

    # ì‘ê°€ ê²¬ì 
    with st.expander("ğŸ¨ ì‘ê°€ ê²¬ì  ê³„ì‚°ê¸° (ì—…ê·¸ë ˆì´ë“œ)"):
        col1_art, col2_art, col3_art = st.columns(3)
        with col1_art:
            sticker = st.selectbox("ìŠ¤í‹°ì»¤ ìš©ì§€", [
                "ìœ í¬ì§€", "ë¦¬ë¬´ë²„ë¸”ìœ í¬ì§€", "ì•„íŠ¸ì§€", "ë¦¬ë¬´ë²„ë¸”ì•„íŠ¸ì§€", "ëª¨ì¡°ì§€", "íˆ¬ëª…ìŠ¤í‹°ì»¤", "ë§ˆìŠ¤í‚¹ì”°"
            ])
        with col2_art:
            fuji = st.selectbox("í›„ì§€ ì¢…ë¥˜", ["ë°±ìƒ‰í›„ì§€", "íˆ¬ëª…í›„ì§€"])
        with col3_art:
            cutting = st.selectbox("ì¬ë‹¨ ì—¬ë¶€", ["ìˆìŒ", "ì—†ìŒ"])
        coating = st.selectbox("ì½”íŒ… í•„ë¦„", [
            "ë¬´ê´‘", "ìœ ê´‘", "ì”°í¬ë²¨ë²³(ë¬´ê´‘)", "ìŠ¤íŒŒí´(ëª¨ë˜ì•Œ)", "ë ˆì¸ë³´ìš°", "ë³„ë¹›", "ìƒŒë“œìŠ¤íƒ€", "ë§¤íŠ¸í„", "ì—†ìŒ"
        ])
        qty = st.number_input("ì œì‘ ìˆ˜ëŸ‰", min_value=1, value=100)
        if st.button("ì‘ê°€ ê²¬ì  ê³„ì‚°", key="artist_calc"):
            base_map = {
                "ìœ í¬ì§€": 2900, "ë¦¬ë¬´ë²„ë¸”ìœ í¬ì§€": 3400, "ì•„íŠ¸ì§€": 2800,
                "ë¦¬ë¬´ë²„ë¸”ì•„íŠ¸ì§€": 3300, "ëª¨ì¡°ì§€": 2800, "íˆ¬ëª…ìŠ¤í‹°ì»¤": 3800, "ë§ˆìŠ¤í‚¹ì”°": 4500
            }
            coating_map = {
                "ë¬´ê´‘": 500, "ìœ ê´‘": 500, "ì”°í¬ë²¨ë²³(ë¬´ê´‘)": 1000, "ìŠ¤íŒŒí´(ëª¨ë˜ì•Œ)": 1000,
                "ë ˆì¸ë³´ìš°": 1000, "ë³„ë¹›": 1000, "ìƒŒë“œìŠ¤íƒ€": 1000, "ë§¤íŠ¸í„": 1300, "ì—†ìŒ": 0
            }
            def fuji_add(sticker_type, fuji_type):
                if fuji_type == "íˆ¬ëª…í›„ì§€":
                    if sticker_type == "ìœ í¬ì§€": return 1100
                    if sticker_type == "ë¦¬ë¬´ë²„ë¸”ìœ í¬ì§€": return 800
                return 0
            unit = base_map[sticker] + coating_map[coating] + fuji_add(sticker, fuji)
            if qty >= 100: unit -= 300
            elif qty >= 70: unit -= 200
            elif qty >= 30: unit -= 100
            if cutting == "ìˆìŒ": unit += 500
            total = unit * qty
            st.success(f"âœ”ï¸ ë‹¨ê°€: {format_result(unit)}ì›")
            st.info(f"ğŸ’° ì´ ê°€ê²©: {format_result(total)}ì›")